<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>DRAM (dram)</TITLE>
<META NAME="description" CONTENT="DRAM (dram)">
<META NAME="keywords" CONTENT="index">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="index.css">

<LINK REL="next" HREF="node59.html">
<LINK REL="previous" HREF="node57.html">
<LINK REL="up" HREF="node55.html">
<LINK REL="next" HREF="node59.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html1627"
  HREF="node59.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1623"
  HREF="node55.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1617"
  HREF="node57.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1625"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1628"
  HREF="node59.html">64 Bit Snapshot (snap64)</A>
<B> Up:</B> <A NAME="tex2html1624"
  HREF="node55.html">System Blocks</A>
<B> Previous:</B> <A NAME="tex2html1618"
  HREF="node57.html">DAC (dac)</A>
 &nbsp; <B>  <A NAME="tex2html1626"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html1629"
  HREF="node58.html#SECTION00431000000000000000">Summary</A>
<LI><A NAME="tex2html1630"
  HREF="node58.html#SECTION00432000000000000000">Mask Parameters</A>
<LI><A NAME="tex2html1631"
  HREF="node58.html#SECTION00433000000000000000">Ports</A>
<LI><A NAME="tex2html1632"
  HREF="node58.html#SECTION00434000000000000000">Description</A>
<UL>
<LI><A NAME="tex2html1633"
  HREF="node58.html#SECTION00434010000000000000">Addressing</A>
<LI><A NAME="tex2html1634"
  HREF="node58.html#SECTION00434020000000000000">.</A>
<LI><A NAME="tex2html1635"
  HREF="node58.html#SECTION00434030000000000000">Data bus width</A>
<LI><A NAME="tex2html1636"
  HREF="node58.html#SECTION00434040000000000000">.</A>
<LI><A NAME="tex2html1637"
  HREF="node58.html#SECTION00434050000000000000">Performance Issues</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00430000000000000000"></A><A NAME="dram"></A>
<BR>
DRAM <SPAN  CLASS="textit">(dram)</SPAN>
</H1> <SPAN  CLASS="textbf">Block Author</SPAN>: Pierre Yves Droz 
<BR><SPAN  CLASS="textbf">Document Author</SPAN>: Jason Manley 
<H2><A NAME="SECTION00431000000000000000">
Summary</A>
</H2>This block interfaces to the BEE2's 1GB DDR2 ECC DRAM modules. Commands that are clocked-in are executed with an unknown delay, however, execution order is maintained.

<P>

<H2><A NAME="SECTION00432000000000000000">
Mask Parameters</A>
</H2>
<TABLE CELLPADDING=3 BORDER="1" WIDTH=468>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textbf">Parameter</SPAN></TD>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Variable</SPAN></TH>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT">DIMM</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">dimm</SPAN></TD>
<TD ALIGN="LEFT">Selects which physical DIMM to use (four per user FPGA).</TD>
</TR>
<TR><TD ALIGN="LEFT">Data Type</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">arith_type</SPAN></TD>
<TD ALIGN="LEFT">Inform Simulink how it should interpret the stored data.</TD>
</TR>
<TR><TD ALIGN="LEFT">Data binary point</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">bin_pt</SPAN></TD>
<TD ALIGN="LEFT">Inform Simulink how it should interpret the stored data - specifically, the bit position in the word where it should place the binary point.</TD>
</TR>
<TR><TD ALIGN="LEFT">Datapath clock rate (MHz)</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">ip_clock</SPAN></TD>
<TD ALIGN="LEFT">Clock rate for DRAM. Default: 200MHz (400DDR).</TD>
</TR>
<TR><TD ALIGN="LEFT">Sample period</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">sample_period</SPAN></TD>
<TD ALIGN="LEFT">Is significant for clocking the block. Default: 1</TD>
</TR>
<TR><TD ALIGN="LEFT">Simulate DRAM using ModelSim</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">use_sim</SPAN></TD>
<TD ALIGN="LEFT">Requires the addition of the ``ModelSim'' block at the top level of the design. Used to simulate DRAM block only.</TD>
</TR>
<TR><TD ALIGN="LEFT">Enable bank management</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">bank_mgt</SPAN></TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">Advise leave off</SPAN> Changes the way the banks are addressed. Clarification required.</TD>
</TR>
<TR><TD ALIGN="LEFT">Use wide data bus (288 bits)</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">wide_data</SPAN></TD>
<TD ALIGN="LEFT">Burst writes require 288 bits. If not selected, provide a 144 bit bus which needs to be supplied with data in consecutive clock cycles to form the 288 bits. 288 bit bus can make for challenging routing!</TD>
</TR>
<TR><TD ALIGN="LEFT">Use half-burst</TD>
<TD ALIGN="LEFT"><SPAN  CLASS="textit">half_burst</SPAN></TD>
<TD ALIGN="LEFT">Only store 144 bits per burst (wastes half capacity as the second 144 bits are unusable). If enabled, requires at least two clock cycles to store 144 bits. Second clock cycle's data is forfeited.</TD>
</TR>
</TABLE>
<P>

<H2><A NAME="SECTION00433000000000000000">
Ports</A>
</H2>
<TABLE CELLPADDING=3 BORDER="1" WIDTH=468>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textbf">Port</SPAN></TD>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Dir.</SPAN></TH>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Data Type</SPAN></TH>
<TH ALIGN="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">rst</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">boolean</TD>
<TD ALIGN="LEFT">Resets the block when pulsed high</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">address</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">UFix_32_0</TD>
<TD ALIGN="LEFT">A signal which accepts the address. See below for details.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">data_in</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">144 or 288 bit unsigned</TD>
<TD ALIGN="LEFT">Accepts data to be saved to DRAM.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">wr_be</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">UFix_18_0 or UFix_36_0</TD>
<TD ALIGN="LEFT">Selects bytes for writing (write byte enable). It is normally 18 bits wide for a 144 bit data bus, but if 288 bit data bus is selected, this becomes a 36 bit variable.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">RWn</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">boolean</TD>
<TD ALIGN="LEFT">Selects read or not-write. <SPAN  CLASS="textit">1</SPAN> for read, <SPAN  CLASS="textit">0</SPAN> for write.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">cmd_tag</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">UFix_32_0</TD>
<TD ALIGN="LEFT">Accepts a user-defined tag for labelling entered commands.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">cmd_valid</SPAN></TD>
<TD ALIGN="LEFT">in</TD>
<TD ALIGN="LEFT">boolean</TD>
<TD ALIGN="LEFT">Clocks data into the command buffer.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">rd_ack</SPAN></TD>
<TD ALIGN="LEFT">out</TD>
<TD ALIGN="LEFT">boolean</TD>
<TD ALIGN="LEFT">Used to acknowledge that the last <SPAN  CLASS="textit">data_out</SPAN> value has been read.</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">cmd_ack</SPAN></TD>
<TD ALIGN="LEFT">out</TD>
<TD ALIGN="LEFT">boolean</TD>
<TD ALIGN="LEFT">Acknowledges that the last command was accepted (when buffer is full, will not accept additional commands).</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">data_out</SPAN></TD>
<TD ALIGN="LEFT">out</TD>
<TD ALIGN="LEFT">UFix_144_0</TD>
<TD ALIGN="LEFT">Outputs data from DRAM, 144 bits at a time. Reads are in groups of 288 bits (ie 2 clocks).</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">rd_tag</SPAN></TD>
<TD ALIGN="LEFT">out</TD>
<TD ALIGN="LEFT">UFix_32_0</TD>
<TD ALIGN="LEFT">Outputs the identifier for the data on <SPAN  CLASS="textit">data_out</SPAN> (as submitted on <SPAN  CLASS="textit">cmd_tag</SPAN> when the command was issued).</TD>
</TR>
<TR><TD ALIGN="LEFT"><SPAN  CLASS="textit">rd_valid</SPAN></TD>
<TD ALIGN="LEFT">out</TD>
<TD ALIGN="LEFT">boolean</TD>
<TD ALIGN="LEFT">Indicates that the data on <SPAN  CLASS="textit">data_out</SPAN> is valid.</TD>
</TR>
</TABLE>
<P>

<H2><A NAME="SECTION00434000000000000000">
Description</A>
</H2>

<P>
This document is a draft and requires verification.

<P>

<H4><A NAME="SECTION00434010000000000000">
Addressing</A>
</H4>

<P>
The 1GB storage DIMMs have 18 512Mbit chips each. They are arranged as 64Mbit x 8 (bus width) x 9 (chips per side/rank) x 2 (sides/ranks). Two ranks (sides) per module with the 9 memory ICs connected in parallel, each holding 8 bits of the data bus width (72 bits). Each IC has four banks, with 13 bits of row addressing and 10 bits for column addressing. Normally, each address would hold 64 bits + parity (8 bits), however, the BEE2 uses the parity space as additional data storage giving a capacity of 1.125 GB per DIMM module.

<P>

<H4><A NAME="SECTION00434020000000000000">.</A>

</H4>

<P>
From Micron's datasheet on the <SPAN  CLASS="textit">MT47H64M8CD-37E</SPAN> (as used by CASPER in its Crucial 1GB <SPAN  CLASS="textit">CT12872AA53E</SPAN> modules): The double data rate architecture is essentially a 4n-prefetch architecture, with an interface designed to transfer two data words per clock cycle at the I/O balls. A single read or write access effectively consists of a single 4n-bit-wide, one-clock-cycle data transfer at the internal DRAM core and four corresponding n-bit-wide, one-half-clock-cycle data transfers at the I/O balls.

<P>
Reads and writes must thus occur four-at-a-time. 4 x 72bits = 288 bits. Although the mapping of the logical to physical addressing is abstracted from the user, it is useful to know how the DRAM block's address bus is derived, as it impacts performance:

<P>
<BR><P></P>
<DIV ALIGN="CENTER"><A NAME="6586"></A>
<TABLE>
<CAPTION><STRONG>Table 3.1:</STRONG>
Address bit assignments</CAPTION>
<TR><TD>
<P>
<DIV ALIGN="CENTER">

</DIV>
<P>
<TABLE CELLPADDING=3 BORDER="1">
<TR><TD ALIGN="CENTER"><P>
Addressing</TD>
<TD ALIGN="CENTER">Assignment</TD>
</TR>
<TR><TD ALIGN="CENTER"><P>
Column</TD>
<TD ALIGN="CENTER">12 downto 3</TD>
</TR>
<TR><TD ALIGN="CENTER">Rank</TD>
<TD ALIGN="CENTER">13</TD>
</TR>
<TR><TD ALIGN="CENTER">Row</TD>
<TD ALIGN="CENTER">27 downto 14</TD>
</TR>
<TR><TD ALIGN="CENTER">Bank</TD>
<TD ALIGN="CENTER">29 downto 28</TD>
</TR>
<TR><TD ALIGN="CENTER">not used</TD>
<TD ALIGN="CENTER">31 downto 30</TD>
</TR>
<TR><TD ALIGN="CENTER"><P></TD>
<TD ALIGN="CENTER">&nbsp;</TD>
</TR>
</TABLE>

<P>

<P>
<A NAME="tab:AddressBitAssignments"></A>
<P>
</TD></TR>
</TABLE>
</DIV><P></P>
<BR>

<P>
Each group of 8 addresses selects a 144 bit logical location (the lowest 3 bits are ignored). For example, address <SPAN  CLASS="textit">0x00</SPAN> through <SPAN  CLASS="textit">0x7</SPAN> all address the same 144 bit location. To address consecutive locations, increment the address port by eight. There are thus a total of <SPAN CLASS="MATH"><IMG
 WIDTH="25" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img83.png"
 ALT="$2^{27}$"></SPAN> possible addresses. The block supports 2GB DIMMs (UNCONFIRMED) since 14 bits of addressing are reserved for row selection. The 1GB DIMMs using Micron 512Mb chips, however, only use 13 bits for row selection which results in <SPAN CLASS="MATH"><IMG
 WIDTH="25" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img84.png"
 ALT="$2^{26}$"></SPAN> possible address locations. Care should be taken when addressing the 1GB DIMMS as bit 27 of the address range is not valid. However, bits 28 and 29 are mapped. Since bit 27 is ignored, it results in overlapping memory spaces.

<P>

<H4><A NAME="SECTION00434030000000000000">
Data bus width</A>
</H4>

<P>
The BEE2 uses ECC DRAM, however, the parity bits are used for data storage rather than parity storage. Thus, the data bus is 72 bits wide instead of the usual 64 bits.

<P>

<H4><A NAME="SECTION00434040000000000000">.</A>

</H4>

<P>
The memory module has a DDR interface requiring two reads or writes per RAM clock cycle (&nbsp;200MHz), thus requiring the user to provide 144 bits per clock cycle. Furthermore, as outlined above, data has to be captured in batches of 288 bits. This can be done in one of two ways: in two consecutive blocks of 144 bits, or over a single 288 bit-wide bus. This is selectable as a Mask parameter. If half-burst is selected, only a 144 bit input is required. 288 bits are still written to DRAM, but the second 144 bits are not specified. Thus, half of the DRAM capacity is unusable.

<P>

<H4><A NAME="SECTION00434050000000000000">
Performance Issues</A>
</H4>

<P>
The performance of the DRAM block is dependant on the relative location of the addressed data and whether or not the mode (read/write) is changed. For example, consecutive column addresses can be written without delay, however, changing rows or banks incur delay penalties. See above for the address bit assignment.

<P>
To obtain optimum performance, it is recommended that the least significant bits be changed first (ie address the memory from 0x00 through to address 0x20000000). This will increment column addresses first, followed by rank change, both of which incur little delay. Changing rows or banks can take twice as long. Further information can be found in Micron's datasheet for the <SPAN  CLASS="textit">MT47H64M8</SPAN>.

<P>

<P>


<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html1627"
  HREF="node59.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1623"
  HREF="node55.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1617"
  HREF="node57.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1625"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1628"
  HREF="node59.html">64 Bit Snapshot (snap64)</A>
<B> Up:</B> <A NAME="tex2html1624"
  HREF="node55.html">System Blocks</A>
<B> Previous:</B> <A NAME="tex2html1618"
  HREF="node57.html">DAC (dac)</A>
 &nbsp; <B>  <A NAME="tex2html1626"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Documentor
2009-01-16
</ADDRESS>
</BODY>
</HTML>
